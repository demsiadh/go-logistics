# 《领运物流》

## 一、系统基础架构



### 1. 技术栈说明&#xA;



*   **前端**：采用 Vue 框架 + AntDesign-Vue 组件库，实现响应式页面布局与数据可视化


*   **后端**：基于 Go 语言 Gin 框架构建，支持高并发场景下的业务逻辑处理


*   **数据库**：使用 MongoDB 非关系型数据库，适合存储地理坐标、订单轨迹等非结构化数据


*   **地图服务**：集成百度地图 API，实现地图展示、路径规划、逆地理编码等空间分析功能


### 2. 架构特点&#xA;



*   前后端分离架构，通过 RESTful API 实现数据交互


*   异步任务机制：订单调度等耗时操作采用后台异步处理，不阻塞用户界面


*   数据持久化：用户对话记录、业务数据均存储于数据库，支持历史追溯


## 二、核心功能模块



### 1. 首页数据看板&#xA;

#### 1.1 营业网点分布&#xA;



*   **功能**：通过百度地图 API 可视化展示所有网点位置，支持点击标注查看网点详情（地址、服务范围、联系人等）


*   **数据来源**：MongoDB 中`outlet`集合存储的网点地理坐标与基础信息


*   **扩展应用**：结合热力图分析网点覆盖密度，辅助决策新网点选址


#### 1.2 订单统计分析&#xA;



*   **展示形式**：近 7 天订单状态（待处理 / 运输中 / 已完成）折线图


*   **指标维度**：每日订单量变化、状态流转趋势


*   **数据接口**：后端`/api/home/order`接口返回 JSON 格式统计数据


#### 1.3 车辆状态监控&#xA;



*   **可视化类型**：车辆状态（空闲 / 运输中 / 维修中）饼状图


*   **实时性**：每分钟刷新一次，数据来自车辆 GPS 定位模块




#### 1.4 线路里程统计&#xA;



*   **分类维度**：按线路类型（常规路线 / 快速路线 / 特殊路线）生成柱状图


*   **数据价值**：分析各类型线路里程


### 2. 用户权限管理&#xA;

#### 2.1 用户定义&#xA;



*   **角色范围**：仅指系统后台操作人员，非终端物流客户


*   **权限分级**：管理员（全功能）


#### 2.2 账号体系&#xA;



*   **认证方式**：账号密码登录，支持 JWT 令牌验证


*   **注册限制**：不可自主注册，需管理员通过后台`/api/users/create`接口创建




### 3. 订单全生命周期管理&#xA;

#### 3.1 订单定义&#xA;



*   **数据结构**：包含寄件人 / 收件人信息、物品类型、重量、关联网点 / 线路 / 车辆 ID 等字段


*   **状态机**：带处理→处理中→已完成→已取消


#### 3.2 核心操作&#xA;



*   **创建订单**：


1.  前端提交订单基础信息


2.  后端触发异步调度任务（`completeDataOrder`函数）


3.  调用百度地图 API 计算最优网点 / 线路 / 车辆组合


4.  将匹配结果回填至订单详情


*   **订单查询**：通过`/api/order/detail`接口获取关联的网点、线路轨迹、车辆实时位置等全量信息


### 4. 营业网点管理&#xA;

#### 4.1 网点定位&#xA;



*   **创建方式**：在百度地图上绘制多边形区域，自动生成地理围栏


*   **坐标存储**：使用 MongoDB 的`geoJSON`类型字段存储多边形顶点坐标


*   **修改限制**：创建后不可修改区域边界，需删除重建


#### 4.2 业务关联&#xA;



*   **订单起点 / 终点**：每个订单必须关联起始网点与目的地网点


*   **线路起点**：运输线路默认从起始网点出发，终点为目的地网点


### 5. 智能线路规划&#xA;

#### 5.1 线路创建方式&#xA;



*   **自动生成**：输入起点 / 终点，调用百度地图生成最优路径


*   **手动绘制**：通过地图选点工具自定义途经点


#### 5.2 数据模型&#xA;



*   **字段说明**：包含线路 ID、起点网点 ID、终点网点 ID、总里程、预计耗时、途经坐标点数组等


*   **关联关系**：每条线路绑定唯一车辆，每辆车同一时间只能执行一条线路任务


### 6. 车辆资源调度&#xA;

#### 6.1 车辆档案&#xA;



*   **基础信息**：车牌号、车型、载重限制、GPS 设备编号、所属网点 ID


*   **状态字段**：`status`（1/2/3），通过车载终端实时更新


#### 6.2 批量操作&#xA;



*   **完成运输**：调用`/api/vehicle/complete`接口，批量标记该车辆所有关联订单为 “已完成”


*   **调度规则**：优先分配距离订单起点最近的空闲车辆，考虑车型与货物匹配度


### 7. 智能客服系统&#xA;

#### 7.1 大模型支持&#xA;



*   **接入模型**：hunyuan-lite（轻量级对话）、hunyuan-turbos（复杂问题推理）、deepseek-r1（推理模型）、deepseek-v3（轻量级对话）


*   **检索增强生成**：可以通过开启检索增强生成来提升对话质量


#### 7.2 对话管理&#xA;



*   **上下文深度**：保留最近 20 条对话记录，支持多轮业务咨询


*   **持久化存储**：对话历史存储于`chat`集合，默认保留 100 条 / 用户


*   **交互限制**：仅回答系统功能相关问题，拒绝涉及用户隐私或外部业务的提问


## 三、操作约束规则



### 1. 数据删除限制&#xA;



*   **禁止操作**：当存在以下关联数据时，目标对象不可删除：



    *   网点：关联未完成订单或线路


    *   线路：关联在途车辆或订单


    *   车辆：绑定未完成订单或线路


    *   用户：存在操作日志或创建的业务数据


### 2. 常规操作规范&#xA;



*   **增删改查**：所有基础功能遵循 RESTful 接口规范，例如：



    *   查询网点：`GET /api/outlet/id`
    
    *   更新车辆状态：`PUT /api/vehicle/update`



## 四、典型使用场景



### 1. 订单调度流程解析&#xA;



```mermaid
graph LR
A[创建订单] --> B[触发异步调度]
B --> C[调用地图API获取网点/线路/车辆候选集]
C --> D[基于距离/时效/载重算法匹配最优组合]
D --> E[回填匹配结果至订单]
E --> F{匹配成功?}
F -->|是| G[订单状态更新为"已分配"]
F -->|否| H[触发人工介入流程]
```

### 2. 网点覆盖范围查询&#xA;



*   **操作步骤**：


1.  在地图上选择目标网点


2.  系统高亮显示该网点的多边形服务区域


3.  显示区域面积、覆盖城市街区等统计信息


### 3. 客服调用示例&#xA;



*   **用户提问**："如何修改已分配车辆的线路？"


*   **处理逻辑**：


1.  deepseek-r1 模型检索线路修改权限规则


2.  若用户为管理员，返回操作指南


## 五、术语表


| 术语&#xA;      | 定义说明&#xA;                                |
| ------------ | ---------------------------------------- |
| 逆地理编码&#xA;   | 将经纬度转换为具体地址的过程，用于解析订单收货地址&#xA;           |
| 地理围栏&#xA;    | 通过多边形区域划定网点服务范围，超出范围的订单需跨网点协作处理&#xA;     |
| 异步任务&#xA;    | 不阻塞主流程的后台处理任务，如订单调度、地图路径计算等&#xA;         |
| JWT 令牌&#xA;  | JSON Web Token，用于用户身份验证，有效期默认 30 分钟&#xA; |
| geoJSON&#xA; | 用于表示地理空间数据的 JSON 格式，支持存储点、线、面等几何对象&#xA;  |
